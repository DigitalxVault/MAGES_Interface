---
phase: 06-polish
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - next.config.ts
  - package.json
  - .gitignore
  - vercel.json
autonomous: true

must_haves:
  truths:
    - "Application loads in under 3 seconds"
    - "Bundle size is optimized for static export"
    - "Application deployed and accessible via Vercel"
    - "All assets are properly referenced"
  artifacts:
    - path: "next.config.ts"
      provides: "Optimized Next.js configuration for static export"
    - path: "vercel.json"
      provides: "Vercel deployment configuration"
  key_links:
    - from: "package.json"
      to: "vercel"
      via: "deployment scripts"
      pattern: "deploy"

<objective>
Optimize performance and deploy to Vercel

Purpose: Optimize bundle size, configure static export, set up Vercel deployment, and ensure the application loads quickly and runs smoothly in production.

Output: Deployed application accessible via Vercel URL with fast load times
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/06-polish/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Optimize Next.js configuration</name>
  <files>
    next.config.ts
  </files>
  <action>
    Update next.config.ts:
    - Enable static export (output: 'export')
    - Configure image optimization for static assets
    - Disable poweredBy header
    - Set up compression
    - Configure asset prefix if needed
    - Ensure trailing slash handling for static hosting
  </action>
  <verify>
    Build produces static HTML/CSS/JS
    No server-side dependencies
    next export works
  </verify>
  <done>
    Next.js configuration optimized
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Vercel configuration</name>
  <files>
    vercel.json
  </files>
  <action>
    Create vercel.json:
    - Configure build command (npm run build)
    - Set output directory (out)
    - Configure clean URLs
    - Set up rewrites for SPA routing if needed
    - Add headers for caching
  </action>
  <verify>
    vercel.json is valid JSON
    Build settings are correct
    Clean URLs work
  </verify>
  <done>
    Vercel configuration created
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify and update .gitignore</name>
  <files>
    .gitignore
  </files>
  <action>
    Update .gitignore:
    - Ensure node_modules is ignored
    - Ignore .next and out directories
    - Ignore build artifacts
    - Ignore environment files (.env.local)
    - Keep sounds/ directory (assets need to be deployed)
  </action>
  <verify>
    Sensitive files ignored
    Build artifacts ignored
    Asset files included
  </verify>
  <done>
    .gitignore updated
  </done>
</task>

<task type="auto">
  <name>Task 4: Add deployment scripts to package.json</name>
  <files>
    package.json
  </files>
  <action>
    Update package.json:
    - Add "deploy" script for Vercel CLI
    - Add "preview" script for local static preview
    - Ensure build script is correct
    - Add "lint" script for quality check
  </action>
  <verify>
    npm run deploy works
    npm run preview works
    npm run lint passes
  </verify>
  <done>
    Deployment scripts added
  </done>
</task>

<task type="auto">
  <name>Task 5: Build and verify production bundle</name>
  <files>
  </files>
  <action>
    Build and verify:
    - Run npm run build
    - Check bundle size
    - Verify static output in out/ directory
    - Test locally with static server
    - Check for console errors
    - Verify all assets load correctly
  </action>
  <verify>
    Build succeeds without errors
    Bundle size is reasonable (<500KB initial)
    All assets referenced correctly
    Local preview works
  </verify>
  <done>
    Production bundle verified
  </done>
</task>

<task type="auto">
  <name>Task 6: Deploy to Vercel</name>
  <files>
  </files>
  <action>
    Deploy to Vercel:
    - Install Vercel CLI if needed
    - Run vercel login
    - Run vercel --prod
    - Note the deployment URL
    - Test live deployment
    - Verify all features work in production
  </action>
  <verify>
    Deployment succeeds
    Live URL is accessible
    All features work in production
    Assets load correctly
  </verify>
  <done>
    Application deployed to Vercel
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. next.config.ts has static export enabled
2. vercel.json is created with correct settings
3. Build produces static files in out/ directory
4. npm run build succeeds without errors
5. npm run preview works locally
6. Bundle size is under 500KB initial load
7. Vercel deployment succeeds
8. Live URL is accessible
9. All 4 panels work in production
10. Audio plays in production
11. Dice roll animation works
12. Timer countdown works
13. Background music plays
14. No console errors in production
</verification>

<success_criteria>
- Static export configured
- Bundle size optimized (<500KB initial)
- Vercel configuration created
- Application deployed to Vercel
- Live URL accessible and functional
- All features work in production
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish/06-02-SUMMARY.md` and update ROADMAP.md with completion status
</output>
