---
phase: 04-timers
plan: 01
type: execute
wave: 2
depends_on: ["01-02"]
files_modified:
  - src/components/TimerPanel.tsx
  - src/stores/appStore.ts
  - src/components/MainInterface.tsx
autonomous: true

must_haves:
  truths:
    - "Countdown timer has preset buttons (30s, 1m, 5m, 10m)"
    - "Countdown timer accepts custom time input"
    - "Timer has start/pause/resume/reset controls"
    - "Timer displays large, readable digits"
    - "Timer shows visual progress indicator"
    - "Timer plays sound when reaching zero"
    - "Stopwatch counts up from 00:00:00"
    - "Stopwatch has start/stop/reset controls"
  artifacts:
    - path: "src/components/TimerPanel.tsx"
      provides: "Countdown timer and stopwatch with alerts"
      exports: ["TimerPanel"]
    - path: "src/stores/appStore.ts"
      provides: "Timer state management with localStorage persistence"
      exports: ["useAppStore"]
  key_links:
    - from: "src/components/TimerPanel.tsx"
      to: "use-sound"
      via: "useSound hook for alert sound"
      pattern: "useSound\\("
    - from: "src/components/TimerPanel.tsx"
      to: "src/stores/appStore.ts"
      via: "useAppStore hook"
      pattern: "useAppStore\\(\\)"

<objective>
Create countdown timer with presets and stopwatch for game timing needs

Purpose: Provide game masters with timing tools for board game sessions - countdown for turn limits and stopwatch for tracking elapsed time.

Output: Working timer panel with countdown (presets + custom) and stopwatch with visual alerts
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-background-music/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add timer state to store</name>
  <files>
    src/stores/appStore.ts
  </files>
  <action>
    Update src/stores/appStore.ts:
    - Add TimerState interface:
      - mode: 'countdown' | 'stopwatch'
      - countdownTime: number (seconds remaining, default 0)
      - stopwatchTime: number (seconds elapsed, default 0)
      - isRunning: boolean
      - initialTime: number (for countdown reset)
    - Add actions:
      - setTimerMode(mode: 'countdown' | 'stopwatch')
      - setCountdownTime(time: number)
      - setStopwatchTime(time: number)
      - setTimerRunning(running: boolean)
      - resetCountdown()
      - resetStopwatch()
      - setTimerInitialTime(time: number)
    - Don't persist timer state (runtime only)
  </action>
  <verify>
    TypeScript compiles without errors
    Timer state added to store
    Actions properly defined
  </verify>
  <done>
    Timer state added to store
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimerPanel component</name>
  <files>
    src/components/TimerPanel.tsx
  </files>
  <action>
    Create src/components/TimerPanel.tsx:
    - 'use client' directive
    - Mode toggle: Countdown | Stopwatch
    - Countdown section:
      - Large time display (MM:SS format, font-label text-5xl+)
      - Preset buttons: 30s, 1m, 5m, 10m
      - Custom input (MM:SS format)
      - Controls: Start/Pause, Reset
      - Circular progress indicator (SVG ring)
      - Flashing animation when time <= 5 seconds
    - Stopwatch section:
      - Large time display (HH:MM:SS format)
      - Controls: Start/Stop, Reset
      - Linear progress indicator (seconds bar)
    - Use useEffect for timer updates (1000ms interval)
    - Play alert sound on countdown zero
  </action>
  <verify>
    TimerPanel renders with mode toggle
    Countdown shows large digits with presets
    Stopwatch shows elapsed time
    Controls work correctly
    Visual progress indicators display
  </verify>
  <done>
    TimerPanel component created
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate TimerPanel into MainInterface</name>
  <files>
    src/components/MainInterface.tsx
  </files>
  <action>
    Update src/components/MainInterface.tsx:
    - Import TimerPanel
    - Replace the "TIMER" placeholder panel
    - Use TimerPanel component
    - Keep DICE panel as placeholder
  </action>
  <verify>
    MainInterface shows TimerPanel
    Other panels unchanged
  </verify>
  <done>
    TimerPanel integrated into main interface
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. MainInterface shows Timer panel
2. Mode toggle switches between Countdown/Stopwatch
3. Countdown preset buttons (30s, 1m, 5m, 10m) work
4. Custom input accepts MM:SS format
5. Start/Pause toggle controls timer
6. Reset button resets to initial time
7. Large digits are readable (text-5xl+)
8. Circular progress ring shows time remaining
9. Timer flashes red when <= 5 seconds
10. Alert sound plays when countdown reaches zero
11. Stopwatch counts up from 00:00:00
12. Stopwatch Start/Stop/Reset work
13. Timer state resets on page refresh
</verification>

<success_criteria>
- Countdown timer with 4 presets + custom input
- Stopwatch with elapsed time tracking
- Large readable digit display
- Visual progress indicators (ring + bar)
- Audio alert on countdown zero
- Start/pause/reset controls for both
- Mode toggle between countdown/stopwatch
- Industrial styling
</success_criteria>

<output>
After completion, create `.planning/phases/04-timers/04-01-SUMMARY.md`
</output>
