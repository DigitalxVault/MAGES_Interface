---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/providers/AudioProvider.tsx
  - src/components/WelcomeScreen.tsx
  - src/components/MainInterface.tsx
  - src/stores/appStore.ts
  - src/app/page.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "User sees welcome screen with 'TAP TO BEGIN' button on first load"
    - "Tapping start button unlocks audio context (Howler.ctx.state === 'running')"
    - "After unlock, welcome screen transitions to main interface"
    - "Main interface displays with industrial panel styling"
    - "Layout adapts to tablet portrait and landscape orientations"
  artifacts:
    - path: "src/providers/AudioProvider.tsx"
      provides: "Audio context management with unlock function"
      exports: ["AudioProvider", "useAudio"]
    - path: "src/components/WelcomeScreen.tsx"
      provides: "Audio unlock entry screen"
      exports: ["WelcomeScreen"]
    - path: "src/components/MainInterface.tsx"
      provides: "Primary application shell"
      exports: ["MainInterface"]
    - path: "src/stores/appStore.ts"
      provides: "Global state with localStorage persistence"
      exports: ["useAppStore"]
  key_links:
    - from: "src/app/page.tsx"
      to: "src/providers/AudioProvider.tsx"
      via: "useAudio hook"
      pattern: "useAudio\\(\\)"
    - from: "src/components/WelcomeScreen.tsx"
      to: "src/providers/AudioProvider.tsx"
      via: "unlock function call"
      pattern: "unlock\\(\\)"
    - from: "src/providers/AudioProvider.tsx"
      to: "howler"
      via: "Howler.ctx.resume()"
      pattern: "Howler\\.ctx"
---

<objective>
Create audio context provider and welcome screen for browser audio policy compliance

Purpose: Browsers require user gesture before playing audio. This plan creates the mandatory welcome screen that unlocks audio and reveals the main interface, completing Phase 1's core functionality.

Output: Working welcome-to-main flow where tapping "TAP TO BEGIN" unlocks Howler.js audio context and transitions to main interface shell
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AudioProvider and Zustand store</name>
  <files>
    src/providers/AudioProvider.tsx
    src/stores/appStore.ts
  </files>
  <action>
    Create src/providers/AudioProvider.tsx:
    - 'use client' directive (client-side audio handling)
    - Create AudioContextValue interface with isUnlocked: boolean and unlock: () => Promise<void>
    - Use React Context with createContext/useContext pattern
    - Import { Howler } from 'howler'
    - unlock function should:
      1. Check if already unlocked (early return)
      2. Check if Howler.ctx exists and state is 'suspended'
      3. Call await Howler.ctx.resume()
      4. Set isUnlocked to true
    - Export AudioProvider component and useAudio hook
    - useAudio hook should throw if used outside provider

    Create src/stores/appStore.ts:
    - Use Zustand with persist middleware
    - State interface:
      - musicVolume: number (default 0.5)
      - effectsVolume: number (default 0.7)
    - Actions:
      - setMusicVolume(volume: number)
      - setEffectsVolume(volume: number)
    - Persist to localStorage with name 'rt-LoFi-storage'
    - Use partialize to only persist volume settings (not runtime state)
    - Use createJSONStorage(() => localStorage) for SSR safety
  </action>
  <verify>
    TypeScript compiles without errors
    AudioProvider exports AudioProvider and useAudio
    useAppStore exports store hook
    Import Howler from 'howler' resolves (peer dep of use-sound)
  </verify>
  <done>
    AudioProvider manages Howler.js context unlock; Zustand store persists volume preferences to localStorage
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WelcomeScreen and MainInterface components</name>
  <files>
    src/components/WelcomeScreen.tsx
    src/components/MainInterface.tsx
  </files>
  <action>
    Create src/components/WelcomeScreen.tsx:
    - 'use client' directive
    - Props: onEnter: () => void
    - Import useAudio hook and RivetButton component
    - Full-screen centered layout (min-h-screen flex items-center justify-center)
    - Industrial background: bg-bg-deep
    - MetalPanel containing:
      - App title "LoFi INTERFACE" in font-label uppercase
      - Subtitle "BOARD GAME CONTROL PANEL" in text-text-muted
      - RivetButton with "TAP TO BEGIN" text, size="lg", variant="primary"
    - handleStart async function:
      1. Call await unlock() from useAudio
      2. Call onEnter()
    - Add subtle visual cue that this is an interaction point (pulsing glow or border)

    Create src/components/MainInterface.tsx:
    - 'use client' directive
    - Responsive layout shell:
      - Portrait: single column flex layout
      - Landscape: 2-column grid (use CSS media query or Tailwind custom breakpoint)
    - Contains placeholder MetalPanel sections for future features:
      - "DICE" panel
      - "TIMER" panel
      - "SOUND EFFECTS" panel
      - "BACKGROUND MUSIC" panel
    - Each panel has:
      - Section label in font-label uppercase text-text-secondary
      - "Coming soon..." placeholder text
    - Use min-h-screen, bg-bg-deep, p-4, gap-4 for base layout
    - For responsive grid, add custom CSS in globals.css for orientation-based breakpoint:
      @media (min-width: 768px) and (orientation: landscape) {
        .tablet-landscape:grid { display: grid; }
        .tablet-landscape:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      }
  </action>
  <verify>
    WelcomeScreen renders centered with MetalPanel and RivetButton
    Button is large enough to tap comfortably (64px height for lg size)
    MainInterface shows 4 placeholder panels
    Resize browser to portrait/landscape - layout changes appropriately
  </verify>
  <done>
    WelcomeScreen shows tap-to-begin entry point; MainInterface provides responsive 4-panel shell for future features
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire up app flow and integrate AudioProvider</name>
  <files>
    src/app/layout.tsx
    src/app/page.tsx
  </files>
  <action>
    Update src/app/layout.tsx:
    - Import AudioProvider
    - Wrap {children} with AudioProvider in the body
    - Keep existing font variables on html element
    - Set body className: bg-bg-deep text-text-primary antialiased

    Update src/app/page.tsx:
    - 'use client' directive (state-dependent rendering)
    - Import WelcomeScreen, MainInterface, useAudio
    - Use local state: const [hasEntered, setHasEntered] = useState(false)
    - Conditional render:
      - If !hasEntered: show WelcomeScreen with onEnter={() => setHasEntered(true)}
      - If hasEntered: show MainInterface
    - This creates the flow: Welcome -> tap -> audio unlocks -> main interface appears

    Alternative approach using useAudio().isUnlocked directly:
    - Show WelcomeScreen if !isUnlocked
    - Show MainInterface if isUnlocked
    - This ensures audio is always unlocked when main interface is visible

    Use the isUnlocked approach for consistency - it ties the UI state directly to audio state.
  </action>
  <verify>
    `npm run dev` - app loads with WelcomeScreen visible
    Click/tap "TAP TO BEGIN" - screen transitions to MainInterface
    Open browser devtools, check console: no AudioContext warnings
    Check Howler.ctx.state in console after clicking - should be 'running'
    Refresh page - back to WelcomeScreen (audio needs re-unlock)
  </verify>
  <done>
    Complete welcome-to-main flow working; tapping begin unlocks audio and shows main interface with 4 placeholder panels
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Fresh page load shows WelcomeScreen with "TAP TO BEGIN" button
2. Tapping button transitions to MainInterface
3. Console shows no "AudioContext was prevented" warnings after tap
4. `Howler.ctx.state` is 'running' after tap (check in devtools console)
5. MainInterface shows 4 panels in single column (portrait) or 2-column grid (landscape)
6. All panels have industrial metal styling from Plan 01-01 components
7. Page refresh returns to WelcomeScreen (audio context requires re-unlock)
8. Touch targets are comfortable to tap on tablet-sized viewport
</verification>

<success_criteria>
- AudioProvider correctly unlocks Howler.js audio context on user gesture
- WelcomeScreen is styled with industrial aesthetic and large tap target
- MainInterface provides responsive 4-panel layout shell
- Transition from welcome to main happens on button tap
- Zustand store persists volume settings (ready for future phases)
- No browser autoplay policy warnings in console
- Layout adapts to portrait/landscape orientations
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
